jQuery(document).ready(function(){var a="";jQuery("input.myc-text").keyup(function(c){a=jQuery(this).val();if(a!=""){jQuery(".send-button").addClass("visible")}else{jQuery(".send-button").removeClass("visible")}});jQuery("input.myc-text").keypress(function(e){if(e.which==13){e.preventDefault();jQuery(".myc-conversation-area .myc-conversation-request").removeClass("myc-is-active");var g=a;var d=new Date();var c=jQuery(this).closest(".myc-container").attr("id");var f=c.split("-");var i=f[2];var h='<div class="myc-conversation-bubble-container myc-conversation-bubble-container-request"><div class="myc-conversation-bubble myc-conversation-request myc-is-active">'+escapeTextInput(g)+"</div>";if(myc_script_vars.show_time){h+='<div class="myc-datetime">'+d.toLocaleTimeString()+"</div>"}h+="</div>";if(myc_script_vars.show_loading){h+='<div class="myc-loading"><i class="myc-icon-loading-dot" /><i class="myc-icon-loading-dot" /><i class="myc-icon-loading-dot" /></div>'}jQuery("#myc-container-"+i+" .myc-conversation-area").append(h);jQuery("#myc-container-"+i+" input.myc-text").val("");jQuery("#myc-container-"+i+" .myc-conversation-area").scrollTop(jQuery("#myc-container-"+i+" .myc-conversation-area").prop("scrollHeight"));textQuery(g,i)}});jQuery(".send-button").click(function(e){console.log(a);jQuery(".myc-conversation-area .myc-conversation-request").removeClass("myc-is-active");var g=a;var d=new Date();var c=jQuery(this).closest(".myc-container").attr("id");var f=c.split("-");var i=f[2];var h='<div class="myc-conversation-bubble-container myc-conversation-bubble-container-request"><div class="myc-conversation-bubble myc-conversation-request myc-is-active">'+escapeTextInput(g)+"</div>";if(myc_script_vars.show_time){h+='<div class="myc-datetime">'+d.toLocaleTimeString()+"</div>"}h+="</div>";if(myc_script_vars.show_loading){h+='<div class="myc-loading"><i class="myc-icon-loading-dot" /><i class="myc-icon-loading-dot" /><i class="myc-icon-loading-dot" /></div>'}jQuery("#myc-container-"+i+" .myc-conversation-area").append(h);jQuery("#myc-container-"+i+" input.myc-text").val("");jQuery("#myc-container-"+i+" .myc-conversation-area").scrollTop(jQuery("#myc-container-"+i+" .myc-conversation-area").prop("scrollHeight"));textQuery(g,i)});if(myc_script_vars.enable_welcome_event){if(jQuery(".myc-container").length>0){jQuery(".myc-container").each(function(d,e){if(jQuery(this).closest(".myc-content-overlay").length>0){if(jQuery(this).closest(".myc-content-overlay").hasClass("myc-toggle-closed")){return true}}var c=jQuery(this).attr("id");var f=c.split("-");var g=f[2];welcomeIntent(g)})}}jQuery(".myc-content-overlay .myc-content-overlay-header").click(function(c){slideToggle()});jQuery(".chat-toggle").click(function(c){slideToggle()});function b(){}});function slideToggle(){var f=jQuery(".myc-content-overlay .myc-content-overlay-header");var a=jQuery(".chat-toggle");if(f.find(".myc-icon-toggle-up").css("display")!=="none"){var c=f.siblings(".myc-content-overlay-container").find(".myc-container");if(myc_script_vars.enable_welcome_event&&jQuery(c).find(".myc-conversation-bubble-container").length==0){var b=jQuery(c).attr("id");var d=b.split("-");var e=d[2];welcomeIntent(e)}f.find(".myc-icon-toggle-up").hide();f.parent().removeClass("myc-toggle-closed");f.parent().addClass("myc-toggle-open");f.find(".myc-icon-toggle-down").show();f.siblings(".myc-content-overlay-container, .myc-content-overlay-powered-by").slideToggle("slow",function(){})}else{f.find(".myc-icon-toggle-down").hide();f.parent().removeClass("myc-toggle-open");f.parent().addClass("myc-toggle-closed");f.find(".myc-icon-toggle-up").show();f.siblings(".myc-content-overlay-container, .myc-content-overlay-powered-by").slideToggle("slow",function(){})}if(a.hasClass("active")){a.removeClass("active").attr("title","Chat with Stratium")}else{a.addClass("active").attr("title","Minimize Chat")}}function welcomeIntent(a){jQuery.ajax({type:"POST",url:myc_script_vars.base_url+"query?v="+myc_script_vars.version_date,contentType:"application/json; charset=utf-8",dataType:"json",headers:{Authorization:"Bearer "+myc_script_vars.access_token},data:JSON.stringify({event:{name:"WELCOME"},lang:myc_script_vars.language,sessionId:myc_script_vars.session_id}),success:function(b){prepareResponse(b,a)},error:function(b){textResponse(myc_script_vars.messages.internal_error,a);jQuery("#myc-container-"+a+" .myc-conversation-area").scrollTop(jQuery("#myc-container-"+a+" .myc-conversation-area").prop("scrollHeight"))}})}function textQuery(a,b){jQuery.ajax({type:"POST",url:myc_script_vars.base_url+"query?v="+myc_script_vars.version_date,contentType:"application/json; charset=utf-8",dataType:"json",headers:{Authorization:"Bearer "+myc_script_vars.access_token},data:JSON.stringify({query:a,lang:myc_script_vars.language,sessionId:myc_script_vars.session_id}),success:function(c){setTimeout(function(){if(myc_script_vars.show_loading){jQuery("#myc-container-"+b+" .myc-loading").empty()}prepareResponse(c,b)},myc_script_vars.response_delay)},error:function(c){if(myc_script_vars.show_loading){jQuery("#myc-container-"+b+" .myc-loading").empty()}textResponse(myc_script_vars.messages.internal_error,b);jQuery("#myc-container-"+b+" .myc-conversation-area").scrollTop(jQuery(".myc-container-"+b+" .myc-conversation-area").prop("scrollHeight"))}})}function prepareResponse(a,g){if(a.status.code=="200"){jQuery(window).trigger("myc_response_success",a);jQuery("#myc-container-"+g+" .myc-conversation-area .myc-conversation-response").removeClass("myc-is-active");var e=a.result.fulfillment.messages;var f=e.length;var b=0;for(b;b<f;b++){var d=e[b];if(myc_script_vars.messaging_platform==d.platform||myc_script_vars.messaging_platform=="default"&&d.platform===undefined||d.platform===undefined&&!hasPlatform(e,myc_script_vars.messaging_platform)){switch(d.type){case 0:textResponse(d.speech,g);break;case 1:cardResponse(d.title,d.subtitle,d.buttons,d.text,d.postback,g);break;case 2:quickRepliesResponse(d.title,d.replies,g);break;case 3:imageResponse(d.imageUrl,g);break;case 3:break;default:}}}}else{textResponse(myc_script_vars.messages.internal_error,g)}jQuery("#myc-container-"+g+" .myc-conversation-area").scrollTop(jQuery("#myc-container-"+g+" .myc-conversation-area").prop("scrollHeight"));if(jQuery("#myc-container-"+g+" #myc-debug-data").length){var c=JSON.stringify(a,undefined,2);jQuery("#myc-container-"+g+" #myc-debug-data").text(c)}}function hasPlatform(d,a){var e=d.length;var b=0;for(b;b<e;b++){var c=d[b];if(c.platform===a){return true}}return false}function textResponse(b,d){if(b===""){b=myc_script_vars.messages.internal_error}var a=new Date();var c='<div class="myc-conversation-bubble-container myc-conversation-bubble-container-response"><div class="myc-conversation-bubble myc-conversation-response myc-is-active myc-text-response">'+b+"</div>";if(myc_script_vars.show_time){c+='<div class="myc-datetime">'+a.toLocaleTimeString()+"</div>"}c+="</div>";jQuery("#myc-container-"+d+" .myc-conversation-area").append(c)}function imageResponse(b,d){if(b===""){textResponse(myc_script_vars.messages.internal_error,d)}else{var a=new Date();var c='<div class="myc-conversation-bubble-container myc-conversation-bubble-container-response"><div class="myc-conversation-bubble myc-conversation-response myc-is-active myc-image-response"><img src="'+b+'"/></div>';if(myc_script_vars.show_time){c+='<div class="myc-datetime">'+a.toLocaleTimeString()+"</div>"}c+="</div>";jQuery("#myc-container-"+d+" .myc-conversation-area").append(c)}}function cardResponse(e,a,c,d,g,f){var b='<div class="myc-card-title">'+e+"</div>";b+='<div class="myc-card-subtitle">'+a+"</div>"}function quickRepliesResponse(e,d,g){var c='<div class="myc-quick-replies-title">'+e+"</div>";var b=0;for(b;b<d.length;b++){c+='<input type="button" class="myc-quick-reply" value="'+d[b]+'" />'}var a=new Date();var f='<div class="myc-conversation-bubble-container myc-conversation-bubble-container-response"><div class="myc-conversation-bubble myc-conversation-response myc-is-active myc-quick-replies-response">'+c+"</div>";if(myc_script_vars.show_time){f+='<div class="myc-datetime">'+a.toLocaleTimeString()+"</div>"}f+="</div>";jQuery("#myc-container-"+g+" .myc-conversation-area").append(f);jQuery("#myc-container-"+g+" .myc-conversation-area .myc-is-active .myc-quick-reply").click(function(i){i.preventDefault();jQuery("#myc-container-"+g+" .myc-conversation-area .myc-conversation-request").removeClass("myc-is-active");var j=jQuery(this).val();var h=new Date();var k='<div class="myc-conversation-bubble-container myc-conversation-bubble-container-request"><div class="myc-conversation-bubble myc-conversation-request myc-is-active">'+escapeTextInput(j)+"</div>";if(myc_script_vars.show_time){k+='<div class="myc-datetime">'+h.toLocaleTimeString()+"</div>"}if(myc_script_vars.show_loading){k+='<div class="myc-loading"><i class="myc-icon-loading-dot" /><i class="myc-icon-loading-dot" /><i class="myc-icon-loading-dot" /></div>'}k+="</div>";jQuery("#myc-container-"+g+" .myc-conversation-area").append(k);textQuery(j,g)})}function customPayload(a,b){}var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function escapeTextInput(a){return String(a).replace(/[&<>"'`=\/]/g,function(b){return entityMap[b]})};