var W3tc_Lightbox={window:jQuery(window),container:null,options:null,create:function(){var b=this;this.container=jQuery('<div class="'+this.options.id+'"><div class="lightbox-close">'+this.options.close+'</div><div id="w3tc_lightbox_content" class="lightbox-content"></div></div>').css({top:0,left:0,width:0,height:0,position:"fixed","z-index":9991,display:"none"});jQuery("#w3tc").append(this.container);b.resize();this.window.resize(function(){b.resize()});this.window.scroll(function(){b.resize()});this.container.find(".lightbox-close").click(function(){b.close()});jQuery(document).keyup(function(a){if(a.keyCode==27){b.close()}})},open:function(c){this.options=jQuery.extend({id:"lightbox",close:"Close window",width:0,height:0,maxWidth:0,maxHeight:0,minWidth:0,minHeight:0,widthPercent:0.6,heightPercent:0.8,content:null,url:null,callback:null},c);this.create();this.resize();if(this.options.content){this.content(this.options.content)}else{if(this.options.url){this.load(this.options.url,this.options.callback);if(typeof ga!="undefined"){var d=this.options.url.match(/w3tc_action=([^&]+)/);if(d&&d[1]){ga("send","pageview","overlays/"+d[1])}else{var d=this.options.url.match(/&(w3tc_[^&]+)&/);if(d&&d[1]){ga("send","pageview","overlays/"+d[1])}}}}}W3tc_Overlay.show();this.container.show()},close:function(){if(this.options.onClose){this.options.onClose()}this.container.remove();W3tc_Overlay.hide()},resize:function(){var c=(this.options.width?this.options.width:this.window.width()*this.options.widthPercent);var d=(this.options.height?this.options.height:this.window.height()*this.options.heightPercent);if(!this.options.maxWidth){this.options.maxWidth=this.window.width()}if(!this.options.maxHeight){this.options.maxHeight=this.window.height()}if(this.options.maxWidth&&c>this.options.maxWidth){c=this.options.maxWidth}else{if(c<this.options.minWidth){c=this.options.minWidth}}if(this.options.maxHeight&&d>this.options.maxHeight){d=this.options.maxHeight}else{if(d<this.options.minHeight){d=this.options.minHeight}}this.container.css({width:c,height:d});this.container.css({top:(this.window.height()/2-this.container.outerHeight()/2)>=0?this.window.height()/2-this.container.outerHeight()/2:0,left:(this.window.width()/2-this.container.outerWidth()/2)>=0?this.window.width()/2-this.container.outerWidth()/2:0});jQuery(".lightbox-content",this.container).css({width:c,height:d})},load:function(e,f){this.content("");this.loading(true);var d=this;jQuery.get(e,{},function(a){d.loading(false);if(a.substr(0,9)==="Location "){w3tc_beforeupload_unbind();window.location=a.substr(9);return}d.content(a);if(f){f.call(this,d)}})},load_form:function(f,i,h){data={};var g=jQuery(i).find("input").each(function(b){var c=jQuery(this).attr("name");var a=jQuery(this).attr("type");if(a=="radio"||a=="checkbox"){if(!jQuery(this).prop("checked")){return}}if(c){data[c]=jQuery(this).val()}});this.content("");this.loading(true);var j=this;jQuery.post(f,data,function(a){j.loading(false);if(a.substr(0,9)==="Location "){w3tc_beforeupload_unbind();window.location=a.substr(9);return}j.content(a);if(h){h.call(this,j)}})},content:function(b){return this.container.find(".lightbox-content").html(b)},width:function(b){if(b===undefined){return this.container.width()}else{this.container.css("width",b);return this.resize()}},height:function(b){if(b===undefined){return this.container.height()}else{this.container.css("height",b);return this.resize()}},loading:function(b){if(b){this.container.find(".lightbox-content").addClass("lightbox-loader")}else{this.container.find(".lightbox-content").removeClass("lightbox-loader")}}};var W3tc_Overlay={window:jQuery(window),container:null,create:function(){var b=this;this.container=jQuery('<div id="overlay" />').css({top:0,left:0,width:0,height:0,position:"fixed","z-index":9990,display:"none",opacity:0.6});jQuery("#w3tc").append(this.container);this.window.resize(function(){b.resize()});this.window.scroll(function(){b.resize()})},show:function(){this.create();this.resize();this.container.show()},hide:function(){this.container.remove()},resize:function(){this.container.css({width:this.window.width(),height:this.window.height()})}};var w3tc_minify_recommendations_checked={};function w3tc_lightbox_minify_recommendations(b){W3tc_Lightbox.open({width:1000,url:"admin.php?page=w3tc_minify&w3tc_test_minify_recommendations&_wpnonce="+b,callback:function(d){var a=jQuery("#recom_theme").val();if(jQuery.ui&&jQuery.ui.sortable){jQuery("#recom_js_files,#recom_css_files").sortable({axis:"y",stop:function(){jQuery(this).find("li").each(function(c){jQuery(this).find("td:eq(1)").html((c+1)+".")})}})}if(w3tc_minify_recommendations_checked[a]!==undefined){jQuery("#recom_js_files :text,#recom_css_files :text").each(function(){var c=jQuery(this).parents("li").find("[name=recom_js_template]").val()+":"+jQuery(this).val();if(w3tc_minify_recommendations_checked[a][c]!==undefined){var f=jQuery(this).parents("li").find(":checkbox");if(w3tc_minify_recommendations_checked[a][c]){f.attr("checked","checked")}else{f.removeAttr("checked")}}})}jQuery("#recom_theme").change(function(){jQuery("#recom_js_files :checkbox,#recom_css_files :checkbox").each(function(){var f=jQuery(this).parents("li");var c=f.find("[name=recom_js_template]").val()+":"+f.find(":text").val();if(w3tc_minify_recommendations_checked[a]===undefined){w3tc_minify_recommendations_checked[a]={}}w3tc_minify_recommendations_checked[a][c]=jQuery(this).is(":checked")});d.load("admin.php?page=w3tc_minify&w3tc_test_minify_recommendations&theme_key="+jQuery(this).val()+"&_wpnonce="+b,d.options.callback)});jQuery("#recom_js_check").click(function(){if(jQuery("#recom_js_files :checkbox:checked").size()){jQuery("#recom_js_files :checkbox").removeAttr("checked")}else{jQuery("#recom_js_files :checkbox").attr("checked","checked")}return false});jQuery("#recom_css_check").click(function(){if(jQuery("#recom_css_files :checkbox:checked").size()){jQuery("#recom_css_files :checkbox").removeAttr("checked")}else{jQuery("#recom_css_files :checkbox").attr("checked","checked")}return false});jQuery(".recom_apply",d.container).click(function(){var c=jQuery("#recom_theme").val();jQuery("#js_files li").each(function(){if(jQuery(this).find(":text").attr("name").indexOf("js_files["+c+"]")!=-1){jQuery(this).remove()}});jQuery("#css_files li").each(function(){if(jQuery(this).find(":text").attr("name").indexOf("css_files["+c+"]")!=-1){jQuery(this).remove()}});jQuery("#recom_js_files li").each(function(){if(jQuery(this).find(":checkbox:checked").size()){w3tc_minify_js_file_add(c,jQuery(this).find("[name=recom_js_template]").val(),jQuery(this).find("[name=recom_js_location]").val(),jQuery(this).find("[name=recom_js_file]").val())}});jQuery("#recom_css_files li").each(function(){if(jQuery(this).find(":checkbox:checked").size()){w3tc_minify_css_file_add(c,jQuery(this).find("[name=recom_css_template]").val(),jQuery(this).find("[name=recom_css_file]").val())}});w3tc_minify_js_theme(c);w3tc_minify_css_theme(c);w3tc_input_enable(".js_enabled",jQuery("#minify_js_enable:checked").size());w3tc_input_enable(".css_enabled",jQuery("#minify_css_enable:checked").size());d.close()})}})}function w3tc_lightbox_self_test(b){W3tc_Lightbox.open({width:800,minHeight:300,url:"admin.php?page=w3tc_dashboard&w3tc_test_self&_wpnonce="+w3tc_nonce,callback:function(a){jQuery(".button-primary",a.container).click(function(){a.close()})}})}function w3tc_lightbox_upgrade(b){W3tc_Lightbox.open({id:"w3tc-overlay",close:"",width:800,height:350,url:"admin.php?page=w3tc_dashboard&w3tc_licensing_upgrade&_wpnonce="+b,callback:function(a){a.options.height=jQuery("#w3tc-upgrade").height()-57;jQuery(".button-primary",a.container).click(function(){a.close()});jQuery("#w3tc-purchase",a.container).click(function(){a.close();w3tc_lightbox_buy_plugin(b)});a.resize()}})}function w3tc_lightbox_buy_plugin(b){W3tc_Lightbox.open({width:800,minHeight:350,maxWidth:jQuery(window).width()-40,maxHeight:jQuery(window).height()-40,url:"admin.php?page=w3tc_dashboard&w3tc_licensing_buy_plugin&_wpnonce="+b,callback:function(d){var a=function(g){if(g.origin.substr(g.origin.length-12)!==".w3-edge.com"){return}var c=g.data.split(" ");if(c[0]==="license"){w3tc_lightbox_save_licence_key(function(){d.close()})}else{if(c[0]==="v2_license"){var h=document.getElementById("buy_frame");if(h.contentWindow&&h.contentWindow.postMessage){h.contentWindow.postMessage("v2_license_accepted","*")}d.options.onClose=function(){window.location=window.location+"&refresh"};w3tc_lightbox_save_licence_key(c[1],b,function(){jQuery("#buy_frame").attr("src",c[3])})}}};if(window.addEventListener){addEventListener("message",a,false)}else{if(attachEvent){attachEvent("onmessage",a)}}jQuery(".button-primary",d.container).click(function(){d.close()})}})}function w3tc_lightbox_save_licence_key(f,e,g){jQuery("#plugin_license_key").val(f);var h={w3tc_default_save_licence_key:1,license_key:f,_wpnonce:e};jQuery.post("admin.php?page=w3tc_dashboard",h,function(a){g()},"json").fail(g)}function w3tc_lightbox_cdn_s3_bucket_location(c,d){W3tc_Lightbox.open({width:500,height:130,url:"admin.php?page=w3tc_dashboard&w3tc_cdn_s3_bucket_location&type="+c+"&_wpnonce="+d,callback:function(a){jQuery(".button",a.container).click(function(){a.close()})}})}jQuery(function(){jQuery(".button-minify-recommendations").click(function(){var b=jQuery(this).metadata().nonce;w3tc_lightbox_minify_recommendations(b);return false});jQuery(".button-self-test").click(function(){var b=jQuery(this).metadata().nonce;w3tc_lightbox_self_test(b);return false});jQuery(".button-buy-plugin").click(function(){w3tc_lightbox_upgrade(w3tc_nonce);jQuery("#w3tc-license-instruction").show();return false});jQuery(".button-cdn-s3-bucket-location,.button-cdn-cf-bucket-location").click(function(){var c="";var d=jQuery(this).metadata().nonce;if(jQuery(this).hasClass("cdn_s3")){c="s3"}else{if(jQuery(this).hasClass("cdn_cf")){c="cf"}}w3tc_lightbox_cdn_s3_bucket_location(c,d);return false});jQuery("body").on("click",".w3tc_lightbox_close",function(){W3tc_Lightbox.close()})});