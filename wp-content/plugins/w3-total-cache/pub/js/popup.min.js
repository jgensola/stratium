function w3tc_seconds_to_string(d){var b="",e,a,c;e=Math.floor(d/86400);if(e){d-=e*86400;b+=e+"d "}a=Math.floor(d/3600);if(a){d-=a*3600;b+=a+"h "}c=Math.floor(d/60);if(c){d-=c*60;b+=c+"m "}if(d){b+=d+"s"}return b}var W3tc_Popup_Cdn_Export_File={paused:0,limit:25,retry_seconds:10,seconds_elapsed:0,timer:null,nonce:"",files:[],initialized:false,upload_files:[],set_progress:function(a){jQuery("#cdn_export_file_progress .bar").width(a+"%");jQuery("#cdn_export_file_progress .percent").html(a+"%")},set_status:function(a){jQuery("#cdn_export_file_status").html(a)},set_processed:function(a){jQuery("#cdn_export_file_processed").html(a)},set_button_text:function(a){jQuery("#cdn_export_file_start").val(a)},set_last_response:function(){var a=new Date();jQuery("#cdn_export_file_last_response").html(a.toLocaleTimeString()+" "+a.toLocaleDateString())},set_elapsed:function(a){jQuery("#cdn_export_file_elapsed").html(a)},add_log:function(c,a,b){jQuery("#cdn_export_file_log").prepend('<div class="log-'+(a==1?"success":"error")+'">'+c+" <strong>"+b+"</strong></div>")},clear_log:function(){jQuery("#cdn_export_file_log").html("")},process:function(){if(this.paused){return}if(!this.initialized){this.upload_files=this.files.slice(0);this.initialized=true}to_upload=this.upload_files.slice(0,this.limit);var a=this;if(to_upload.length){jQuery.ajax({type:"POST",url:"admin.php?page=w3tc_cdn",data:{w3tc_cdn_export_process:1,"files[]":to_upload,_wpnonce:this.nonce},dataType:"json",success:function(b){a.set_last_response();a.process_callback(b)},error:function(){a.set_last_response();a.retry(a.retry_seconds)}})}},retry:function(b){if(this.paused){return}this.set_status("request failed (retry in "+b+"s)");if(b){var a=this;setTimeout(function(){a.retry(--b)},1000)}else{this.set_status("processing");this.process()}},process_callback:function(d){var a=false;for(var b=0;b<d.results.length;b++){var e=d.results[b].file;for(var f=0;f<this.upload_files.length;f++){if(this.upload_files[f]==e){this.upload_files.splice(f,1);break}}this.add_log(e,d.results[b].result,d.results[b].error);if(d.results[b].result==-1){a=true;break}}if(a){this.set_progress(0);this.set_processed(1);this.set_status("failed");this.set_button_text("Start");clearInterval(this.timer)}else{var c=this.files.length-this.upload_files.length;this.set_progress((c*100/this.files.length).toFixed(0));this.set_processed(c);if(this.upload_files.length){this.process()}else{this.set_status("done");this.set_button_text("Start");clearInterval(this.timer)}}},timer_callback:function(){this.seconds_elapsed++;this.set_elapsed(w3tc_seconds_to_string(this.seconds_elapsed))},init:function(){var a=this;jQuery("#cdn_export_file_start").click(function(){if(this.value=="Pause"){a.paused=1;a.set_button_text("Resume");a.set_status("paused");clearInterval(a.timer)}else{if(this.value=="Start"){a.seconds_elapsed=0;a.initialized=false;a.clear_log();a.set_progress(0);a.set_processed(0);a.set_elapsed("-")}a.paused=0;a.set_button_text("Pause");a.set_status("processing");a.timer=setInterval(function(){a.timer_callback()},1000)}a.process()})}};var W3tc_Popup_Cdn_Export_Library={paused:0,limit:25,offset:0,retry_seconds:10,seconds_elapsed:0,timer:null,nonce:"",set_progress:function(a){jQuery("#cdn_export_library_progress .bar").width(a+"%");jQuery("#cdn_export_library_progress .percent").html(a+"%")},set_status:function(a){jQuery("#cdn_export_library_status").html(a)},set_processed:function(a){jQuery("#cdn_export_library_processed").html(a)},set_total:function(a){jQuery("#cdn_export_library_total").html(a)},set_button_text:function(a){jQuery("#cdn_export_library_start").val(a)},set_last_response:function(){var a=new Date();jQuery("#cdn_export_library_last_response").html(a.toLocaleTimeString()+" "+a.toLocaleDateString())},set_elapsed:function(a){jQuery("#cdn_export_library_elapsed").html(a)},add_log:function(c,a,b){jQuery("#cdn_export_library_log").prepend('<div class="log-'+(a==1?"success":"error")+'">'+c+" <strong>"+b+"</strong></div>")},clear_log:function(){jQuery("#cdn_export_library_log").html("")},process:function(){if(this.paused){return}var a=this;jQuery.ajax({type:"POST",url:"admin.php?page=w3tc_cdn",data:{w3tc_cdn_export_library_process:1,limit:this.limit,offset:this.offset,_wpnonce:this.nonce},dataType:"json",success:function(b){a.set_last_response();a.process_callback(b)},error:function(){a.set_last_response();a.retry(a.retry_seconds)}})},retry:function(b){if(this.paused){return}this.set_status("request failed (retry in "+b+"s)");if(b){var a=this;setTimeout(function(){a.retry(--b)},1000)}else{this.set_status("processing");this.process()}},process_callback:function(d,b){this.offset+=d.count;this.set_total(d.total);this.set_processed(this.offset);this.set_progress((this.offset*100/d.total).toFixed(0));var a=false;for(var c=0;c<d.results.length;c++){this.add_log(d.results[c].remote_path,d.results[c].result,d.results[c].error);if(d.results[c].result==-1){a=true;break}}if(a){this.set_progress(0);this.set_processed(1);this.set_status("failed");this.set_button_text("Start");clearInterval(this.timer)}else{if(this.offset<d.total){this.process()}else{this.set_status("done");this.set_button_text("Start");clearInterval(this.timer)}}},timer_callback:function(){this.seconds_elapsed++;this.set_elapsed(w3tc_seconds_to_string(this.seconds_elapsed))},init:function(){var a=this;jQuery("#cdn_export_library_start").click(function(){if(this.value=="Pause"){a.paused=1;a.set_status("paused");a.set_button_text("Resume");clearInterval(a.timer)}else{if(this.value=="Start"){a.offset=0;a.seconds_elapsed=0;a.clear_log();a.set_progress(0);a.set_elapsed("-")}a.paused=0;a.set_status("processing");a.set_button_text("Pause");a.timer=setInterval(function(){a.timer_callback()},1000)}a.process()})}};var W3tc_Popup_Cdn_Import_Library={paused:0,limit:5,offset:0,retry_seconds:10,seconds_elapsed:0,timer:null,nonce:"",cdn_host:"",set_progress:function(a){jQuery("#cdn_import_library_progress .bar").width(a+"%");jQuery("#cdn_import_library_progress .percent").html(a+"%")},set_status:function(a){jQuery("#cdn_import_library_status").html(a)},set_processed:function(a){jQuery("#cdn_import_library_processed").html(a)},set_total:function(a){jQuery("#cdn_import_library_total").html(a)},set_button_text:function(a){jQuery("#cdn_import_library_start").val(a)},set_last_response:function(){var a=new Date();jQuery("#cdn_import_library_last_response").html(a.toLocaleTimeString()+" "+a.toLocaleDateString())},set_elapsed:function(a){jQuery("#cdn_import_library_elapsed").html(a)},is_redirect_permanent:function(){return(jQuery("#cdn_import_library_redirect_permanent:checked").size()>0)},is_redirect_cdn:function(){return(jQuery("#cdn_import_library_redirect_cdn:checked").size()>0)},add_log:function(c,a,b){jQuery("#cdn_import_library_log").prepend('<div class="log-'+(a==1?"success":"error")+'">'+c+" <strong>"+b+"</strong></div>")},clear_log:function(){jQuery("#cdn_import_library_log").html("")},add_rule:function(b,c){if(/^https?:\/\//.test(b)){return}if(this.is_redirect_cdn()){c="http://"+(this.cdn_host.length>0?this.cdn_host:document.location.host)+"/"+c}else{c="/"+c}if(b.indexOf("/")!=0){b="/"+b}var a=jQuery("#cdn_import_library_rules");a.val(a.val()+"Redirect "+(this.is_redirect_permanent()?"302 ":"")+b+" "+c+"\r\n")},clear_rules:function(){jQuery("#cdn_import_library_rules").val("")},process:function(){if(this.paused){return}var b=this;var a=jQuery("input#cdn_import_external").is(":checked");jQuery.ajax({type:"POST",url:"admin.php?page=w3tc_cdn",data:{w3tc_cdn_import_library_process:1,limit:this.limit,offset:this.offset,_wpnonce:this.nonce,cdn_import_external:a},dataType:"json",success:function(c){b.set_last_response();b.process_callback(c)},error:function(){b.set_last_response();b.retry(b.retry_seconds)}})},retry:function(b){if(this.paused){return}this.set_status("request failed (retry in "+b+"s)");if(b){var a=this;setTimeout(function(){a.retry(--b)},1000)}else{this.set_status("processing");this.process()}},process_callback:function(c){this.offset+=c.count;this.set_total(c.total);this.set_processed(this.offset);this.set_progress((this.offset*100/c.total).toFixed(0));var a=false;for(var b=0;b<c.results.length;b++){this.add_log(c.results[b].src,c.results[b].result,c.results[b].error);if(c.results[b].result==1){this.add_rule(c.results[b].src,c.results[b].dst)}else{if(c.results[b].result==-1){a=true;break}}}if(a){this.set_progress(0);this.set_processed(1);this.set_status("failed");this.set_button_text("Start");clearInterval(this.timer)}else{if(this.offset<c.total){this.process()}else{this.set_status("done");this.set_button_text("Start");clearInterval(this.timer)}}},timer_callback:function(){this.seconds_elapsed++;this.set_elapsed(w3tc_seconds_to_string(this.seconds_elapsed))},init:function(){var a=this;jQuery("#cdn_import_library_start").click(function(){if(this.value=="Pause"){a.paused=1;a.set_button_text("Resume");a.set_status("paused");clearInterval(a.timer)}else{if(this.value=="Start"){a.offset=0;a.seconds_elapsed=0;a.clear_log();a.set_progress(0);a.clear_rules();a.set_elapsed("-")}a.paused=0;a.set_button_text("Pause");a.set_status("processing");a.timer=setInterval(function(){a.timer_callback()},1000)}a.process()})}};var W3tc_Popup_Cdn_Rename_Domain={paused:0,limit:25,offset:0,retry_seconds:10,seconds_elapsed:0,timer:null,nonce:"",set_progress:function(a){jQuery("#cdn_rename_domain_progress .bar").width(a+"%");jQuery("#cdn_rename_domain_progress .percent").html(a+"%")},set_status:function(a){jQuery("cdn_rename_domain_status").html(a)},set_processed:function(a){jQuery("#cdn_rename_domain_processed").html(a)},set_total:function(a){jQuery("#cdn_rename_domain_total").html(a)},set_button_text:function(a){jQuery("#cdn_rename_domain_start").val(a)},set_last_response:function(){var a=new Date();jQuery("#cdn_rename_domain_last_response").html(a.toLocaleTimeString()+" "+a.toLocaleDateString())},set_elapsed:function(a){jQuery("#cdn_rename_domain_elapsed").html(a)},add_log:function(c,a,b){jQuery("#cdn_rename_domain_log").prepend('<div class="log-'+(a==1?"success":"error")+'">'+c+" <strong>"+b+"</strong></div>")},clear_log:function(){jQuery("#cdn_rename_domain_log").html("")},get_domain_names:function(){return jQuery("#cdn_rename_domain_names").val()},process:function(){if(this.paused){return}var a=this;jQuery.ajax({type:"POST",url:"admin.php?page=w3tc_cdn",data:{w3tc_cdn_rename_domain_process:1,names:this.get_domain_names(),limit:this.limit,offset:this.offset,_wpnonce:this.nonce},dataType:"json",success:function(b){a.set_last_response();a.process_callback(b)},error:function(){a.set_last_response();a.retry(a.retry_seconds)}})},retry:function(b){if(this.paused){return}this.set_status("request failed (retry in "+b+"s)");if(b){var a=this;setTimeout(function(){a.retry(--b)},1000)}else{this.set_status("processing");this.process()}},process_callback:function(c){this.offset+=c.count;this.set_total(c.total);this.set_processed(this.offset);this.set_progress((this.offset*100/c.total).toFixed(0));var a=false;for(var b=0;b<c.results.length;b++){this.add_log(c.results[b].old,c.results[b].result,c.results[b].error);if(c.results[b].result==-1){a=true;break}}if(a){this.set_progress(0);this.set_processed(1);this.set_status("failed");this.set_button_text("Start");clearInterval(this.timer)}else{if(this.offset<c.total){this.process()}else{this.set_status("done");this.set_button_text("Start");clearInterval(this.timer)}}},timer_callback:function(){this.seconds_elapsed++;this.set_elapsed(w3tc_seconds_to_string(this.seconds_elapsed))},init:function(b){var a=this;this.cdn_host=b;jQuery("#cdn_rename_domain_start").click(function(){if(this.value=="Pause"){a.paused=1;a.set_button_text("Resume");a.set_status("paused");clearInterval(a.timer)}else{if(this.value=="Start"){if(!a.get_domain_names()){alert("Empty domains to rename!");return}a.offset=0;a.seconds_elapsed=0;a.clear_log();a.set_progress(0);a.set_elapsed("-")}a.paused=0;a.set_button_text("Pause");a.set_status("processing");a.timer=setInterval(function(){a.timer_callback()},1000)}a.process()})}};function w3tc_ps_expand(a){jQuery(".ps-rule").each(function(){var c=jQuery(this).find(".ps-expander");var b=jQuery(this).find(".ps-expand a");if(!a){c.hide();b.html("+")}else{c.show();b.html("-")}})}jQuery(function(){jQuery(".tab").click(function(){jQuery(".tab").removeClass("tab-selected");jQuery(".tab-content").hide();jQuery(this).addClass("tab-selected");jQuery(this.rel).show()});jQuery(".cdn_queue_delete").click(function(){return confirm("Are you sure you want to remove this file from the queue?")});jQuery(".cdn_queue_empty").click(function(){return confirm("Are you sure you want to empty the queue?")});jQuery(".ps-rule").click(function(){var c=jQuery(this).find(".ps-expander");var b=jQuery(this).find(".ps-expand a");if(c.is(":visible")){c.hide();b.html("+")}else{c.show();b.html("-")}return false});jQuery(".ps-rule p a,.ps-expander").click(function(a){a.stopPropagation()});jQuery(".ps-expand-all").click(function(){w3tc_ps_expand(1)});jQuery(".ps-collapse-all").click(function(){w3tc_ps_expand(0)});jQuery(".ps-refresh").click(function(){var a=jQuery(".w3tc-widget-ps-nonce").val();document.location.href="admin.php?page=w3tc_dashboard&w3tc_test_pagespeed_results&force=1&_wpnonce="+a})});